@model List<HumanResourceManagement.Models.ThongKe>

<div class="container mt-4">
    <div class="d-flex justify-content-between mb-3">
        <a href="@Url.Action("Index", "ThongKe")" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Quay lại
        </a>
        <div class="d-flex gap-2">
            <button onclick="window.print()" class="btn btn-primary">
                <i class="fas fa-print"></i> In báo cáo
            </button>
            <button id="btnExport" class="btn btn-success">
                <i class="fas fa-file-word"></i> Xuất Báo Cáo
            </button>

        </div>
    </div>
</div>

@if (Model != null && Model.Count > 0)
{
    <table class="table table-bordered text-center">
        <thead class="table-dark text-white">
            <tr>
                <th>Phòng Ban</th>
                <th>Số Lượng</th>
                <th>Danh Sách Nhân Viên</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model)
            {
                <tr>
                    <td class="fw-bold">@item.Ten</td>
                    <td><span class="badge bg-primary fs-6">@item.SoLuong</span></td>
                    <td class="text-start">
                        @foreach (var ten in item.DanhSachNhanVien)
                        {
                            <span class="badge bg-info text-dark me-1 mb-1">@ten</span>
                        }
                    </td>
                </tr>
            }
        </tbody>
    </table>
}
else
{
    <div class="alert alert-danger text-center">⚠️ Không có dữ liệu</div>
}

<!-- Modal Xuất Báo Cáo -->
<div id="reportPreviewModal" style="display:none;">
    <div class="modal-content">
        <div class="report-header" style="text-align: center; margin-bottom: 20px;">
            <p style="font-weight: bold; margin-bottom: 5px;">CỘNG HÒA XÃ HỘI CHỦ NGHĨA VIỆT NAM</p>
            <p style="font-weight: bold; margin-bottom: 5px;">Độc lập - Tự do - Hạnh phúc</p>
            <p style="margin-bottom: 5px;">---------------------</p>
            <h2 style="text-transform: uppercase; margin-bottom: 20px;">Báo cáo thống kê phòng ban</h2>
        </div>

        <div class="report-info" style="margin-bottom: 20px;">
            <p><strong>Ngày báo cáo:</strong> @DateTime.Now.ToString("dd/MM/yyyy")</p>
        </div>

        <div class="statistics" style="margin-bottom: 30px;">
            <h3 style="border-bottom: 1px solid #333; padding-bottom: 5px;">1. Tổng quan</h3>
            <p>- Tổng số phòng ban: <strong>@Model.Count</strong></p>
            <p>- Tổng số nhân viên: <strong>@Model.Sum(m => m.SoLuong)</strong></p>
        </div>

        <div class="report-section">
            <h3 style="border-bottom: 1px solid #333; padding-bottom: 5px;">2. Danh sách phòng ban</h3>
            <table style="width: 100%; border-collapse: collapse; margin-bottom: 30px;">
                <thead>
                    <tr style="background-color: #f2f2f2;">
                        <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">STT</th>
                        <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Phòng Ban</th>
                        <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Số Lượng</th>
                        <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Danh Sách Nhân Viên</th>
                    </tr>
                </thead>
                <tbody>
                    @{
                        int stt = 1;
                        foreach (var item in Model)
                        {
                            <tr>
                                <td style="border: 1px solid #ddd; padding: 8px;">@(stt++)</td>
                                <td style="border: 1px solid #ddd; padding: 8px;">@item.Ten</td>
                                <td style="border: 1px solid #ddd; padding: 8px;">@item.SoLuong</td>
                                <td style="border: 1px solid #ddd; padding: 8px;">
                                    @foreach (var ten in item.DanhSachNhanVien)
                                    {
                                        <span class="badge bg-info text-dark me-1 mb-1">@ten</span>
                                    }
                                </td>
                            </tr>
                        }
                    }
                </tbody>
            </table>
        </div>

        <div class="report-footer" style="text-align: right; margin-top: 50px;">
            <div style="display: inline-block; text-align: center;">
                <p style="font-weight: bold; margin-bottom: 50px;">Người lập báo cáo</p>
                <p>(Ký và ghi rõ họ tên)</p>
            </div>
        </div>

        <div class="form-group" style="text-align: center; margin-top: 20px;">
            <button type="button" id="confirmExport" class="btn-submit">Xác nhận</button>
            <button type="button" id="cancelExport" class="btn-submit">Hủy</button>
        </div>
    </div>
</div>

<style>
    .badge {
        font-size: 14px;
        padding: 6px 10px;
        border-radius: 10px;
    }

    #reportPreviewModal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        display: none;
        justify-content: center;
        align-items: center;
    }

    .modal-content {
        background-color: #fff;
        padding: 20px;
        border-radius: 10px;
        max-width: 90%;
        overflow-y: auto;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .btn-submit {
        padding: 10px 20px;
        background-color: #007bff;
        color: white;
        border: none;
        cursor: pointer;
        margin: 10px;
    }

        .btn-submit:hover {
            background-color: #0056b3;
        }
</style>

<script type="text/javascript">
    document.getElementById("btnExport").addEventListener("click", function () {
        document.getElementById("reportPreviewModal").style.display = "flex";
    });

    document.getElementById("cancelExport").addEventListener("click", function () {
        document.getElementById("reportPreviewModal").style.display = "none";
    });

    document.getElementById("confirmExport").addEventListener("click", function () {
        // Ẩn phần "Xác nhận" và "Hủy" trước khi xuất báo cáo
        document.querySelector(".form-group").style.display = "none";

        // Lấy nội dung báo cáo từ modal
        var reportContent = document.querySelector("#reportPreviewModal .modal-content").innerHTML;

        // Tạo file Word từ nội dung báo cáo
        var blob = new Blob([reportContent], { type: 'application/msword' });
        var link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = 'BaoCaoPhongBan.doc';
        link.click();

        // Hiển thị lại phần "Xác nhận" và "Hủy" sau khi xuất báo cáo
        document.querySelector(".form-group").style.display = "block";

        // Đóng modal sau khi xuất báo cáo
        document.getElementById("reportPreviewModal").style.display = "none";
    });
</script>
